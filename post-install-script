#!/usr/bin/env bash

# Prepare yay pacman wrapper (in $HOME)
cd $HOME
which yay || git clone https://aur.archlinux.org/yay.git && cd yay && makepkg -si
cd $HOME
rm -rf yay

xargs -p -a pkglist.txt yay --noredownload --norebuild --clean -S

# enable and start necessary services (for systray and startup)
sudo systemctl enable NetworkManager.service && systemctl start NetworkManager.service
sudo systemctl enable bluetooth.service && systemctl start bluetooth.service
sudo systemctl enable sshd.service && systemctl start sshd.service

# Services for network time.
sudo systemctl enable systemd-timesyncd.service && systemctl start systemd-timesyncd.service # synchronizing network time

# Services needed for printing to devices on local network.
# (https://wiki.archlinux.org/index.php/CUPS#cups-browsed)
sudo systemctl enable org.cups.cupsd.service && systemctl start org.cups.cupsd.service # service for discovering printers
sudo systemctl enable avahi-daemon.service && sudo systemctl start avahi-daemon.service # multicast discovery (needed for cups)
sudo systemctl enable cups-browsed.service && sudo systemctl start cups-browsed.service

# Tools are obtained if missing:
# SpaceVim
[ -d "$HOME/.SpaceVim" ] || curl -sLf https://spacevim.org/install.sh | bash

# Sdkman
which sdk || curl -s "https://get.sdkman.io" | bash

# Pip packages
which pip && which tmuxp || pip install --user tmuxp
